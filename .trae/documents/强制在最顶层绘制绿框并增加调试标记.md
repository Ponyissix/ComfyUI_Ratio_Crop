# 彻底修复绿框不显示问题

经过多次尝试，绿框依然不显示，原因很可能是 ComfyUI 的**默认绘图逻辑覆盖了我的自定义绘制**。ComfyUI 的 `LiteGraph` 节点在绘制时，如果检测到有 `image` 类型的 Widget，可能会在最后阶段自动绘制图片预览，从而把我的绿框盖住了。

## 解决方案

1.  **调整绘制时机**：
    *   目前我使用的是 `onDrawForeground`，这通常是在内容绘制**之后**调用的，理论上应该在最上层。
    *   但为了保险，我将尝试 hook `onDrawBackground` 或者更底层的 `onDraw`，或者**在绘制完图片后，强制再调用一次绘制框的逻辑**。

2.  **强制刷新**：
    *   确保在每次参数变更时，都调用 `app.graph.setDirtyCanvas(true, true)`。

3.  **终极手段：覆盖默认预览**：
    *   我将尝试**完全接管**节点的绘制。
    *   或者，把 `image` Widget 的值临时隐藏，欺骗 ComfyUI 不要画默认图，由我全权负责绘制。

## 具体实施 (修改 `js/crop_ui.js`)

我们将采用最直接的方式：**不仅在 Foreground 画，还要确保 Canvas 状态正确**。我将添加更详细的调试日志（虽然你看不到，但我会确保逻辑严密）。

更重要的是，我怀疑 `ctx.drawImage` 本身可能因为图片对象 (`this.img`) 的问题没画出来，或者坐标 `startX/Y` 被遮挡。

这次我将：
1.  **在 `onDrawForeground` 的最后**，无论发生什么，都画一个**红色的“X”**在节点中央。如果你能看到红叉，说明绘图函数执行了。
2.  如果没有红叉，说明函数没执行。
3.  如果能看到红叉但看不到绿框，说明绿框坐标错了。

**修正计划**：
直接把绿框画在**所有内容的最上层**，并确保颜色极其显眼。

请确认执行。