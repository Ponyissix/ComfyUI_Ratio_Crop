# 新增批量智能裁切节点计划 (OwlViT + SAM)

针对您关于**文字区域和 Logo 区域**识别的需求，**OwlViT (Open-Vocabulary Object Detection)** 是目前在不引入繁重 OCR 依赖（如 PaddleOCR）的情况下，**最佳的通用解决方案**。

OwlViT 是一个多模态模型，它不仅认识具体的物体（如猫、狗），也非常擅长理解抽象概念。您只需在 Prompt 中输入 `"text"`, `"logo"`, `"watermark"`, 或 `"signboard"`，它就能很好地定位这些区域，然后配合 **SAM** 进行精准的轮廓分割。

因此，我们的技术路线保持不变，依然采用 **OwlViT + SAM** 组合，这能完美覆盖您的常规物体识别以及文字/Logo 识别需求。

## 1. 节点功能定义

### A. 批量加载器 (RatioBatchLoader)
*   **功能**: 遍历文件夹读取图片，支持分页 (`start_index`, `limit`)，自动将图片尺寸调整为统一大小（以第一张图为准）以满足 Batch 处理要求。
*   **输入**: `folder_path`, `limit`, `start_index`.
*   **输出**: `IMAGE` (Batch), `filenames` (List).

### B. SAM智能裁切 (RatioAutoCropSAM)
*   **核心逻辑**: OwlViT 检测位置 -> SAM 分割轮廓 -> 自动裁切。
*   **输入**:
    *   `image`: 输入图片批次。
    *   `text_prompt`: 识别提示词 (支持 "text", "logo" 等)。
    *   `box_threshold`: 检测灵敏度 (建议 0.1-0.2)。
    *   `padding`: 裁切冗余。
    *   `ratio`: 目标比例。
*   **输出**: `cropped_image`, `mask`, `crop_data`.

## 2. 模型配置 (自动下载至项目目录)

*   **检测模型**: `google/owlvit-base-patch32` (~600MB)
    *   *擅长*: 通用物体、文字区域、Logo、水印检测。
*   **分割模型**: `facebook/sam-vit-base` (~375MB)
    *   *擅长*: 根据检测框生成极高精度的像素级蒙版。

## 3. 执行计划

1.  **依赖确认**: 确认 `transformers` 库 (已就绪)。
2.  **工具函数**: 编写 `model_utils.py`，负责从国内镜像 (`hf-mirror.com`) 下载模型到 `ComfyUI_Ratio_Crop/models/`。
3.  **核心开发**:
    *   实现 `RatioBatchLoader`：处理文件遍历和 Tensor 转换。
    *   实现 `RatioAutoCropSAM`：集成 OwlViT 和 SAM 的推理流程。
4.  **注册与测试**: 注册节点并验证流程。
