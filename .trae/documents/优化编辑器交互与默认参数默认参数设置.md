# 交互体验与默认值优化

用户提出了一系列细致的交互改进需求：

1.  **绘制时隐藏绿框**：在涂抹蒙版的过程中，绿色的裁切框会干扰视线，需要暂时隐藏。
2.  **缩略图显示蒙版**：节点上的预览图（updatePreview）不仅要显示绿框，还应该把用户画的红色蒙版也叠加上去。
3.  **比例默认值**：强制“Smart”为默认，并移除“Free”选项（或将其藏起来？用户说“去掉”，那就去掉）。
4.  **Padding 默认值**：从 50px 改为 200px。

## 实施方案

### 1. 修改 `js/crop_ui.js`

*   **绘制时隐藏绿框**：
    *   在 `draw()` 函数中增加一个状态判断 `isDrawing`。
    *   如果 `isDrawing` 为 true，或者当前没有计算过 crop（初始状态），则不绘制 `strokeRect` 和尺寸文字。
    *   或者更简单的逻辑：只要用户没点“确认”或“生成”，就不显示绿框？不，用户希望的是**绘制过程中**不显示。
    *   我们在 `mousedown` (开始绘制) 时设置一个标志位 `hideCropBox = true`，在 `mouseup` (结束绘制) 时保持 `true`？
    *   根据之前的改动，现在是“确认时才计算”。所以在确认之前，绿框其实是旧的。
    *   **新逻辑**：打开编辑器时，如果不显示旧框，或者显示旧框但不显示新框？
    *   **用户意图**：涂抹时别挡着。
    *   **实现**：在 `isDrawing` 为 true 时，`draw()` 函数跳过绿框绘制。

*   **缩略图显示蒙版**：
    *   目前 `updatePreview` 是重新画了一遍图和绿框，但没有画 Mask。
    *   Mask 数据目前只存在于编辑器临时的 `maskCanvas` 中，或者上传后的文件里。
    *   节点对象 `this` 上没有持久化 Mask 图像数据。
    *   **挑战**：关闭编辑器后，`maskCanvas` 就销毁了。虽然我们上传了文件，但再次加载图片比较慢。
    *   **方案**：在点击确认时，将 `maskCanvas` 的内容拷贝一份存到 `this.maskImg` (HTMLImageElement) 中。
    *   在 `updatePreview` 中，如果 `this.maskImg` 存在，就把它画上去。

*   **比例与 Padding**：
    *   修改下拉菜单的选项列表，移除 "Free"。
    *   修改 Padding input 的默认值为 200。
    *   修改 `nodes.py` 中 ratio 的默认列表（虽然 JS 决定了 UI，但后端校验也需要一致）。

### 2. 修改 `nodes.py`
*   更新 `ratio` 的输入列表，移除 "Free"。
*   更新 `padding` 的默认值（如果有的话，目前 padding 主要是前端参数，后端 RatioMergeNode 有 padding 参数，但 Crop 节点没有）。
*   Crop 节点的 padding 是前端行为，所以只改 JS 即可。

## 执行步骤
1.  **JS 改造**：
    *   修改 `ratioSelect` 选项。
    *   修改 `paddingInput` 默认值。
    *   修改 `draw` 函数，支持 `isDrawing` 状态下隐藏绿框。
    *   修改 `confirmBtn.onclick`，保存 mask 到 `this.maskImg`。
    *   修改 `updatePreview`，支持绘制 `this.maskImg`。
2.  **后端同步**：
    *   修改 `nodes.py` 的 `INPUT_TYPES`，移除 "Free"。

请确认执行。