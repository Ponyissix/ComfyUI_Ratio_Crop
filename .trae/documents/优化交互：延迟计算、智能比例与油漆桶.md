# 交互优化与智能匹配升级

根据用户反馈，我们需要对现有的交互逻辑进行三项关键改进：

## 1. 逻辑调整：延迟计算
*   **现状**：每次鼠标松开（涂抹一笔结束）就会触发 `autoCropFromMask`，导致绿框跳动，干扰用户连续涂抹。
*   **改进**：在涂抹过程中**完全不更新绿框**。只有当用户点击“确认裁切”按钮（即退出编辑器）的那一瞬间，或者显式点击一个“生成框”按钮时，才执行计算逻辑。
*   **UI 调整**：为了让用户在退出前能预览，可以增加一个“预览框 (Preview Crop)”按钮，或者保持“确认即计算”的极简逻辑。为了更好的体验，建议在点击“确认”时，先计算，更新 UI 显示（一闪而过），然后关闭弹窗。

## 2. 智能比例匹配 (Smart Ratio Matching)
*   **需求**：用户涂抹完一个区域后，系统应该**自动猜**用户想要什么比例，而不是强行套用下拉菜单里选死的比例。
*   **算法**：
    1.  计算蒙版（加 Padding 后）的原始宽高比 `raw_ratio = w / h`。
    2.  定义预设比例列表：`[1:1 (1.0), 3:4 (0.75), 4:3 (1.33), 9:16 (0.56), 16:9 (1.77), 21:9 (2.33)]`。
    3.  **寻找最近邻**：计算 `raw_ratio` 与所有预设比例的差值，找到差距最小的那个比例。
    4.  **自动选中**：将下拉菜单自动切换到匹配到的比例。
    5.  **应用裁切**：使用该比例计算最终框。
*   **触发条件**：
    *   我们需要在 UI 上增加一个选项：`比例: 智能匹配 (Smart)`。
    *   或者，当比例选择为 `Free` 时，不做约束；当选择特定比例时，强制约束；当选择新增的 `Smart` 时，执行上述逻辑。

## 3. 新增工具：油漆桶 (Flood Fill)
*   **需求**：一键填充封闭区域，或者填充整个画布（如果点击空白处）。
*   **实现**：
    *   在工具栏增加“油漆桶”按钮。
    *   实现 `floodFill` 算法（BFS/DFS）：
        *   获取点击位置的像素颜色。
        *   从该点开始，向四面八方扩散，填充所有颜色相同（或相似）的像素。
        *   由于我们的 Mask 层是透明背景，这通常意味着填充透明区域为红色。
    *   **简化版**：针对蒙版编辑，油漆桶通常有两种用法：
        1.  **填充轮廓内部**：用户画了一个圈，点内部，填满。
        2.  **全屏填充**：直接填满整个画布。
    *   考虑到 Web Canvas 像素操作性能，简单的递归可能会爆栈。需要用迭代栈实现高效填充。

## 实施计划
1.  **修改 `js/crop_ui.js`**：
    *   移除 `mouseup` 事件中的 `autoCropFromMask` 调用。
    *   在工具栏增加“油漆桶”图标/按钮。
    *   实现 Canvas 像素级泛洪填充算法。
    *   在比例下拉菜单中增加 `Smart` 选项，并设为默认。
    *   修改 `autoCropFromMask` 逻辑，增加对 `Smart` 模式的支持（寻找最近比例）。
    *   在点击“确认”时，先调用 `autoCropFromMask` 更新坐标，再执行保存关闭流程。

请确认执行。